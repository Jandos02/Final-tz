# Система прогнозирования оттока клиентов банка

## Описание проекта

Данный проект реализует систему машинного обучения для прогнозирования оттока клиентов банка. Система включает в себя:

- Анализ данных и построение модели машинного обучения
- REST API для получения прогнозов
- Docker-контейнер для развертывания

## Структура проекта

```
├── bank_churn_analysis.ipynb  # Jupyter Notebook с анализом данных и обучением модели
├── app.py                     # API сервис на FastAPI
├── requirements.txt           # Зависимости Python
├── Dockerfile                 # Конфигурация Docker
├── docker-compose.yml         # Docker Compose конфигурация
├── TZ.csv                     # Исходные данные
├── models/                    # Обученные модели и препроцессоры
│   ├── final_model.joblib
│   ├── label_encoder_gender.joblib
│   └── columns_info.json
└── README.md                  # README файл
```

## Требования

- Python 3.9+
- Docker и Docker Compose (для контейнеризации)

## Установка и запуск

### 1. Подготовка данных и обучение модели

Сначала запустите Jupyter Notebook для анализа данных и обучения модели:

```bash
# Установка зависимостей
pip install -r requirements.txt

# Запуск Jupyter Notebook
jupyter notebook bank_churn_analysis.ipynb
```

Выполните все ячейки в ноутбуке для:
- Анализа данных
- Обучения моделей
- Сохранения лучшей модели в папку `models/`

### 2. Запуск API локально

```bash
# Установка зависимостей (если не установлены)
pip install -r requirements.txt

# Запуск API
uvicorn app:app --host 0.0.0.0 --port 8000
```

API будет доступен по адресу: http://localhost:8000

### 3. Запуск с Docker

```bash
# Сборка и запуск контейнера
docker-compose up --build

# Или альтернативно:
docker build -t bank-churn-api .
docker run -p 8000:8000 bank-churn-api
```

## Использование API

### Основные эндпоинты

- `GET /` - Главная страница API
- `GET /health` - Проверка состояния сервиса
- `POST /predict` - Прогнозирование оттока клиента
- `GET /model_info` - Информация о модели

### Пример запроса для прогнозирования

```bash
curl -X POST "http://localhost:8000/predict" \
     -H "Content-Type: application/json" \
     -d '{
       "кредитный_рейтинг": 650,
       "город": "Алматы",
       "пол": "Male",
       "возраст": 35,
       "стаж_в_банке": 5,
       "баланс_депозита": 100000,
       "число_продуктов": 2,
       "есть_кредитка": 1,
       "активный_клиент": 1,
       "оценочная_зарплата": 120000
     }'
```

### Пример ответа

```json
{
  "score": 0.23,
  "prediction": 0
}
```

### Интерактивная документация

После запуска API, документация Swagger будет доступна по адресу:
- http://localhost:8000/docs

## Описание полей входных данных

- `кредитный_рейтинг` (float): Кредитный рейтинг клиента
- `город` (str): Город клиента ("Алматы", "Астана", "Атырау")
- `пол` (str): Пол клиента ("Male", "Female")
- `возраст` (float): Возраст клиента
- `стаж_в_банке` (float): Стаж в банке (годы)
- `баланс_депозита` (float, optional): Баланс депозита
- `число_продуктов` (float): Количество банковских продуктов
- `есть_кредитка` (float): Наличие кредитной карты (0/1)
- `активный_клиент` (float): Активность клиента (0/1)
- `оценочная_зарплата` (float): Оценочная зарплата

## Описание ответа

- `score` (float): Вероятность оттока (0-1)
- `prediction` (int): Бинарный прогноз (0 - остается, 1 - уйдет)

## Результаты модели

После выполнения анализа в Jupyter Notebook вы получите:

- Сравнение нескольких моделей машинного обучения
- Метрики качества (ROC-AUC, GINI, Precision, Recall, F1-Score)
- Анализ важности признаков
- Визуализацию результатов

## Остановка сервиса

```bash
# Для Docker Compose
docker-compose down

# Для локального запуска
Ctrl+C в терминале
```

## Мониторинг и логи

```bash
# Просмотр логов
docker-compose logs -f

# Проверка состояния контейнера
docker-compose ps
```

## Техническая информация

- **Фреймворк API**: FastAPI
- **Библиотека ML**: scikit-learn, XGBoost, LightGBM
- **Веб-сервер**: Uvicorn
- **Контейнеризация**: Docker
- **Валидация данных**: Pydantic

## Автор
Алпысбаев Жандос
Проект создан в рамках технического задания по прогнозированию оттока клиентов банка.
